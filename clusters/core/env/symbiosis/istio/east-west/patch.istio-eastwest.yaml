---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: gateway
spec:
  dependsOn:
    - name: istio-base
      namespace: istio-system
    - name: istiod
      namespace: istio-system
  values:
    serviceAccount:
      create: true
    podAnnotations:
      prometheus.io/port: "15020"
      prometheus.io/scrape: "true"
      prometheus.io/path: "/stats/prometheus"
      inject.istio.io/templates: "gateway"
      sidecar.istio.io/inject: "true"
    securityContext:
      fsGroup: 1122
      runAsNonRoot: true
      runAsUser: 1122
      runAsGroup: 1122
      sysctls:
        - name: net.ipv4.ip_unprivileged_port_start
          value: "0"
    containerSecurityContext:
      runAsNonRoot: true
      runAsGroup: 1122
      runAsUser: 1122
      readOnlyRootFilesystem: true
    networkGateway: "network2"
    service:
      type: LoadBalancer
      ports:
        - name: status-port
          port: 15021
          protocol: TCP
          targetPort: 15021
        - name: tls
          port: 15443
          protocol: TLS
      annotations: {}
      loadBalancerIP: ""
      loadBalancerSourceRanges: []
      externalTrafficPolicy: "Local"
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 2000m
        memory: 1024Mi
    autoscaling:
      enabled: true
      minReplicas: 1
      maxReplicas: 2
      targetCPUUtilizationPercentage: 80
