---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: longhorn
spec:
  values:
    persistence:
      defaultClass: true
      defaultClassReplicaCount: 3
    defaultSettings:
      defaultReplicaCount: 3
      backupTarget: s3://longhorn@longhorn-minio
      backupTargetCredentialSecret: longhorn-backup-secret
      defaultDataPath: /var/lib/longhorn
      createDefaultDiskLabeledNodes: true
    ingress:
      enabled: true
      ingressClassName: traefik-internal
      host: "storage.${SECRET_DOMAIN}"
      tls: true
      tlsSecret: "crj-wildcard-certificate"
      annotations:
        hajimari.io/enable: "true"
        hajimari.io/icon: "harddisk"
        hajimari.io/appName: "Longhorn Storage"
        hajimari.io/group: "Cluster"
    longhornManager:
      nodeSelector:
        crutonjohn.com/storage: "longhorn"
    longhornDriver:
      nodeSelector:
        crutonjohn.com/storage: "longhorn"
    longhornUI:
      nodeSelector:
        crutonjohn.com/storage: "longhorn"
