---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: stackrox-secure-cluster-services
spec:
  values:
    clusterName: home-cluster
    confirmNewClusterName: home-cluster
    # Custom labels associated with a secured cluster in Red Hat Advanced Cluster Security.
    clusterLabels: {}
    # The gRPC endpoint for accessing StackRox Central.
    centralEndpoint: central.{{ .Release.Namespace }}.svc:443
    additionalCAs: null
    createUpgraderServiceAccount: true
    imagePullSecrets:
      allowNone: true
      useFromDefaultServiceAccount: true
    env:
      openshift: false
      istio: false
    # Sensor specific configuration.
    sensor:
      # Kubernetes image pull policy for Sensor.
      imagePullPolicy: IfNotPresent
      # Resource configuration for the sensor container.
      resources:
        requests:
          memory: "1Gi"
          cpu: "1"
        limits:
          memory: "4Gi"
          cpu: "2"
      # Use a nodeSelector for sensor
      nodeSelector:
        kubernetes.io/arch: amd64
      # Address of the Sensor endpoint including port number. No trailing slash.
      # Rarely needs to be changed.
      endpoint: sensor.stackrox.svc:443
    # Admission Control specific configuration.
    admissionControl:
      # This setting controls whether the cluster is configured to contact the StackRox
      # Kubernetes Security Platform with `AdmissionReview` requests for create events on
      # Kubernetes objects.
      listenOnCreates: false
      # This setting controls whether the cluster is configured to contact the StackRox Kubernetes
      # Security Platform with `AdmissionReview` requests for update events on Kubernetes objects.
      listenOnUpdates: false
      # This setting controls whether the cluster is configured to contact the StackRox
      # Kubernetes Security Platform with `AdmissionReview` requests for update Kubernetes events
      # like exec and portforward.
      #
      # Defaults to `false` on OpenShift, to `true` otherwise.
      listenOnEvents: true
      # Use a nodeSelector for admission control pods
      nodeSelector:
        kubernetes.io/arch: amd64
      # Dynamic part of the configuration which is retrieved from Central and can be modified through
      # the frontend.
      dynamic:
        # It controls whether the StackRox Kubernetes Security Platform evaluates policies for object
        # updates; if it's disabled, all `AdmissionReview` requests are automatically accepted. You must
        # specify `listenOnUpdates` as `true` for this to work.
        enforceOnUpdates: false
        # Controls whether the StackRox Kubernetes Security Platform evaluates policies.
        # If disabled, all AdmissionReview requests are automatically accepted. You must specify
        # `listenOnCreates` as `true` for this to work.
        enforceOnCreates: false
        scanInline: false
        # If enabled, bypassing the Admission Controller is disabled.
        disableBypass: false
        # The maximum time in seconds, the StackRox Kubernetes Security Platform should wait while
        # evaluating admission review requests. Use it to set request timeouts when you enable image scanning.
        # If the image scan runs longer than the specified time, the StackRox Kubernetes Security Platform
        # accepts the request. Other enforcement options, such as scaling the deployment to zero replicas,
        # are still applied later if the image violates applicable policies.
        timeout: 3
      # Kubernetes image pull policy for Admission Control.
      imagePullPolicy: IfNotPresent
      # Resource configuration for the Admission Control container.
      resources:
        requests:
          memory: "100Mi"
          cpu: "50m"
        limits:
          memory: "500Mi"
          cpu: "500m"
    # Collector specific configuration.
    collector:
      # Collection method to use. Can be one of:
      #   - EBPF
      #   - KERNEL_MODULE
      #   - NO_COLLECTION
      collectionMethod: KERNEL_MODULE
      # Configure usage of taint tolerations. If `false`, tolerations are applied to collector,
      # and the collector pods can schedule onto all nodes with taints. If `true`, no tolerations
      # are applied, and the collector pods won't scheduled onto nodes with taints.
      disableTaintTolerations: false
      # Configure whether slim Collector images should be used or not. Using slim Collector images
      # requires Central to provide the matching kernel module or eBPF probe. If you are running
      # the StackRox Kubernetes Security Platform in offline mode, you must download a kernel support
      # package from [stackrox.io](https://install.stackrox.io/collector/support-packages/index.html)
      # and upload it to Central for slim Collectors to function. Otherwise, you must ensure that
      # Central can access the online probe repository hosted at https://collector-modules.stackrox.io/.
      slimMode: false
      # Kubernetes image pull policy for Collector.
      imagePullPolicy: IfNotPresent
      # Resource configuration for the Collector container.
      resources:
        requests:
          memory: "200Mi"
          cpu: "50m"
        limits:
          memory: "500Mi"
          cpu: "300m"
      complianceImagePullPolicy: IfNotPresent
      # Resource configuration for the Compliance container.
      complianceResources:
        requests:
          memory: "10Mi"
          cpu: "10m"
        limits:
          memory: "2Gi"
          cpu: "1"
      auditLogs:
        disableCollection: true
