---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: keycloak
spec:
  values:
    auth:
      createAdminUser: true
      adminUser: user
      managementUser: manager
      existingSecret: "keycloak-secrets"
      tls:
        enabled: false
    proxyAddressForwarding: true
    serviceDiscovery:
      enabled: false
      protocol: kubernetes.KUBE_PING
      properties: []
      transportStack: tcp
    replicaCount: 1
    containerPorts:
      http: 8080
      https: 8443
    podSecurityContext:
      enabled: true
      fsGroup: 5600
    containerSecurityContext:
      enabled: true
      runAsUser: 5600
      runAsNonRoot: true
    nodeSelector:
      kubernetes.io/arch: "amd64"
    service:
      type: ClusterIP
      port: 80
      httpsPort: 443
      nodePorts:
        http: ""
        https: ""
      clusterIP: ""
      loadBalancerIP: ""
      loadBalancerSourceRanges: []
      externalTrafficPolicy: Cluster
      annotations: {}
    ingress:
      enabled: true
      hostname: keycloak.${SECRET_DOMAIN}
      apiVersion: ""
      ingressClassName: "external"
      path: /
      pathType: ImplementationSpecific
      annotations:
        external-dns.alpha.kubernetes.io/target: "${DYNAMIC_DOMAIN}"
        external-dns/public: "true"
      tls: true
      extraHosts: []
      extraTls:
        - hosts:
            - keycloak.${SECRET_DOMAIN}
          secretName: crj-wildcard-certificate
      secrets: []
      existingSecret: ""
      servicePort: http
    serviceAccount:
      create: true
      name: ""
    metrics:
      enabled: false
      service:
        port: 9990
        annotations:
          prometheus.io/scrape: "true"
          prometheus.io/port: "{{ .Values.metrics.service.port }}"
      serviceMonitor:
        enabled: false
        namespace: ""
        interval: 30s
        scrapeTimeout: ""
        relabellings: []
        honorLabels: false
        additionalLabels: {}
    postgresql:
      enabled: false
    externalDatabase:
      host: "keycloak-db-postgresql"
      port: 5432
      user: keycloak
      password: "${KEYCLOAK_DATABASE_PASSWORD}"
      database: bitnami_keycloak
      existingSecret: ""
