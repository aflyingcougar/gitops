---
apiVersion: opentelemetry.io/v1alpha1
kind: OpenTelemetryCollector
metadata:
  name: host-logging
spec:
  mode: daemonset
  image: otel/opentelemetry-collector-contrib:0.80.0
  nodeSelector:
    kubernetes.io/arch: amd64
  volumeMounts:
    - name: hostvarlog
      mountPath: /host/var/log
  volumes:
    - name: hostvarlog
      hostPath:
        path: /var/log
        type: Directory
  config: |
    receivers:
      filelog:
        include:
          - /host/var/log/syslog
          - /host/var/log/pods/*
      otlp:
        protocols:
          grpc:
    processors:
      batch:
      attributes:
        actions:
          - action: insert
            key: loki.attribute.labels
            value: log.file.name
    exporters:
      logging:
        verbosity: detailed
      loki:
        endpoint: "http://100.64.0.4:3100/loki/api/v1/push"
    service:
      pipelines:
        logs:
          receivers:
            - otlp
            - filelog
          processors:
            - batch
            - attributes
          exporters:
            - logging
            - loki
