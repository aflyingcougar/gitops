---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: amcrest2mqtt
  labels:
    istioInject: "true"
spec:
  values:
    env:
      TZ: America/New_York
      AMCREST_HOST: 192.168.134.62
      AMCREST_PORT: 80
      AMCREST_USERNAME: admin
      AMCREST_PASSWORD: "${AMCREST_ADMIN_PASSWORD}"
      MQTT_HOST: emqx
      MQTT_PORT: 1883
      MQTT_USERNAME: "${SECRET_MQTT_USERNAME}"
      MQTT_PASSWORD: "${SECRET_MQTT_PASSWORD}"
      HOME_ASSISTANT: true
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
            - matchExpressions:
                - key: feature.node.kubernetes.io/custom-zzh
                  operator: In
                  values:
                    - "true"
