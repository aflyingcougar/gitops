---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: traefik
  namespace: network-system
  annotations:
spec:
  releaseName: traefik
  helmVersion: v3
  chart:
    repository: https://containous.github.io/traefik-helm-chart
    name: traefik
    version: 8.12.0
  values:
    deployment:
      replicas: 3
    ports:
      traefik:
        port: 9000
        expose: true
        exposedPort: 9000
        protocol: TCP
      web:
        port: 8000
        expose: true
        exposedPort: 80
        protocol: TCP
      websecure:
        port: 8443
        expose: true
        exposedPort: 443
        protocol: TCP
    providers:
      kubernetesCRD:
        enabled: true
      kubernetesIngress:
        enabled: true
        # IP used for Kubernetes Ingress endpoints
        publishedService:
          enabled: false
    logs:
      # Traefik logs concern everything that happens to Traefik itself (startup, configuration, events, shutdown, and so on).
      general:
          # By default, the logs use a text format (common), but you can
          # also ask for the json format in the format option
          # format: json
          # By default, the level is set to ERROR. Alternative logging levels are DEBUG, PANIC, FATAL, ERROR, WARN, and INFO.
          level: DEBUG
      access:
          # To enable access logs
          enabled: true
          # By default, logs are written using the Common Log Format (CLF).
          # To write logs in JSON, use json in the format option.
          # If the given format is unsupported, the default (CLF) is used instead.
          # format: json
          # To write the logs in an asynchronous fashion, specify a bufferingSize option.
          # This option represents the number of log lines Traefik will keep in memory before writing
          # them to the selected output. In some cases, this option can greatly help performances.
          # bufferingSize: 100
          # Filtering https://docs.traefik.io/observability/access-logs/#filtering
          filters: {}
          # statuscodes: "200,300-302"
          # retryattempts: true
          # minduration: 10ms
          # Fields
          # https://docs.traefik.io/observability/access-logs/#limiting-the-fieldsincluding-headers
          fields:
          general:
              defaultmode: keep
              names: {}
              # Examples:
              # ClientUsername: drop
          headers:
              defaultmode: drop
              names: {}
              # Examples:
              # User-Agent: redact
              # Authorization: drop
              # Content-Type: keep
    ingressRoute:
      dashboard:
        enabled: true
        # Additional ingressRoute annotations (e.g. for kubernetes.io/ingress.class)
        annotations: {}
        # Additional ingressRoute labels (e.g. for filtering IngressRoute by custom labels)
        labels: {}
    service:
      enabled: true
      type: LoadBalancer
      annotations: {}
      spec:
        externalTrafficPolicy: Cluster
        loadBalancerIP: "192.168.130.100"
      # externalIPs:
      #   - 192.168.130.100
      #   - 192.168.130.101
    globalArguments:
      - "--global.checknewversion"
      - "--global.sendanonymoususage"
    additionalArguments: 
    nodeSelector:
      node-role.kubernetes.io/master: ""
    tolerations:
      - key: "node-role.kubernetes.io/master"
        effect: "NoSchedule"