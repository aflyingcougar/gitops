ingress:
  enabled: true
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: 10G
    cert-manager.io/cluster-issuer: letsencrypt-prod
    external-dns.alpha.kubernetes.io/target: ${EXTERNAL_IP}
    kubernetes.io/ingress.class: "external"
    nginx.ingress.kubernetes.io/server-snippet: |-
        server_tokens off;
        proxy_hide_header X-Powered-By;
        client-max-body-size 10G;

        rewrite ^/.well-known/webfinger /public.php?service=webfinger last;
        rewrite ^/.well-known/host-meta /public.php?service=host-meta last;
        rewrite ^/.well-known/host-meta.json /public.php?service=host-meta-json;
        location = /.well-known/carddav {
          return 301 $scheme://$host/remote.php/dav;
        }
        location = /.well-known/caldav {
          return 301 $scheme://$host/remote.php/dav;
        }
        location = /robots.txt {
          allow all;
          log_not_found off;
          access_log off;
        }
        location ~ ^/(?:build|tests|config|lib|3rdparty|templates|data)/ {
          deny all;
        }
        location ~ ^/(?:autotest|occ|issue|indie|db_|console) {
          deny all;
        }
  tls:
    - secretName: cloud-os-crutonjohn-com
      hosts:
        - cloud.${EXTERNAL_DOMAIN}
nextcloud:
  host: cloud.${EXTERNAL_DOMAIN}
  username: admin
  password: ${NEXTCLOUD_APP_ADMIN_PASSWORD}
  update: 0
  datadir: /var/www/html/data
  tableprefix:
  persistence:
    subPath:
  mail:
    enabled: true
    fromAddress: cloud
    domain: ${SMTP_DOMAIN}
    smtp:
      host: ${SMTP_HOST}
      secure: ssl
      port: ${SMTP_SSL_PORT}
      authtype: LOGIN
      name: ${SMTP_USERNAME}
      password: ${SMTP_PASSWORD}
externalDatabase:
  enabled: true
  type: postgresql
  host: ${NEXTCLOUD_DB_HOST}
  existingSecret:
    enabled: true
    secretName: nextcloud-db-secrets
    usernameKey: POSTGRES_USER
    passwordKey: POSTGRES_PASSWORD