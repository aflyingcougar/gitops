---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: navidrome
  namespace: media
  annotations:
    fluxcd.io/ignore: "false"
    fluxcd.io/automated: "false"
    fluxcd.io/tag.loki: semver:~v1.
    fluxcd.io/tag.promtail: semver:~v1.
spec:
  releaseName: navidrome
  chart:
    repository: https://k8s-at-home.com/charts/
    name: 
    version: 2.4.0
  values:
    image:
      repository: deluan/navidrome
      pullPolicy: IfNotPresent
      tag: 0.39.0

    strategy:
      type: Recreate

    service:
      port:
        port: 4533

    env:
      ND_SCANINTERVAL: 15m
      ND_LOGLEVEL: info
      ND_SESSIONTIMEOUT: 24h
      ND_ENABLETRANSCODINGCONFIG: "true"
      ND_MUSICFOLDER: /music

    persistence:
      config:
        enabled: true
        emptyDir: false
        mountPath: /data
        accessMode: ReadWriteOnce
        ## Persistent Volume Storage Class
        ## If defined, storageClassName: <storageClass>
        ## If set to "-", storageClassName: "", which disables dynamic provisioning
        ## If undefined (the default) or set to null, no storageClassName spec is
        ##   set, choosing the default provisioner.  (gp2 on AWS, standard on
        ##   GKE, AWS & OpenStack)
        storageClass: "longhorn"
        # accessMode: ReadWriteOnce
        size: 5Gi
        ## Do not delete the pvc upon helm uninstall
        # skipuninstall: false
        # existingClaim: ""
      music:
        enabled: true
        emptyDir: false
        mountPath: /music
        accessMode: ReadWriteOnce
        ## Persistent Volume Storage Class
        ## If defined, storageClassName: <storageClass>
        ## If set to "-", storageClassName: "", which disables dynamic provisioning
        ## If undefined (the default) or set to null, no storageClassName spec is
        ##   set, choosing the default provisioner.  (gp2 on AWS, standard on
        ##   GKE, AWS & OpenStack)
        # storageClass: "-"
        # accessMode: ReadWriteOnce
        # size: 1Gi
        ## Do not delete the pvc upon helm uninstall
        # skipuninstall: false
        existingClaim: "music-library"